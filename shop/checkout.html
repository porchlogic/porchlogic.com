<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Porch Logic – Checkout</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <link rel="stylesheet" href="../css/pico.css" />
    <style>
        .hidden {
            display: none !important;
        }
        .spinner {
            border: 0.125rem solid transparent;
            border-top-color: currentColor;
            border-right-color: currentColor;
            border-radius: 999px;
            width: 1rem;
            height: 1rem;
            display: inline-block;
            vertical-align: middle;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <header class="container">
        <nav>
            <ul>
                <li>
                    <a href="/" class="contrast"><strong>Porch Logic</strong></a>
                </li>
                <li><a href="./index.html">Shop</a></li>
            </ul>
            <ul>
                <li>
                    <a href="./cart.html">
                        Cart <span class="cart-count" aria-live="polite">0</span>
                    </a>
                </li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <header>
            <p class="secondary">Checkout</p>
            <h1>Complete your order</h1>
        </header>

        <article>
            <header>
                <h2>Payment</h2>
                <p class="secondary">
                    All payments are handled by Stripe. We don’t see your card details.
                </p>
            </header>

            <form id="payment-form">
                <label for="email">Email</label>
                <input id="email" type="email" autocomplete="email" required />
                <div id="email-errors" class="field-error"></div>

                <label>
                    <input type="checkbox" id="subscribe-checkbox" />
                    <span>Keep me in the loop about future Porch Logic experiments.</span>
                </label>

                <label>Shipping address</label>
                <div id="shipping-address-element"></div>

                <label>Payment</label>
                <div id="payment-element"></div>

                <p id="payment-message" class="payment-message hidden" role="status"></p>

                <button id="submit" type="submit">
                    <span id="spinner" class="spinner hidden" aria-hidden="true"></span>
                    <span id="button-text">Pay</span>
                </button>
            </form>

            <p class="secondary">
                After payment, you’ll be redirected back to Porch Logic to confirm everything worked.
            </p>
        </article>
    </main>

    <footer class="container">
        <small>Porch Logic &copy; <span id="year"></span></small>
    </footer>

    <!-- Stripe.js v3 – Basil or newer -->
    <script src="https://js.stripe.com/basil/stripe.js"></script>

    <!-- Cart functions (getCartItems, etc.) -->
    <script src="./cart.js"></script>

    <!-- Your existing checkout logic, unchanged -->
    <script src="./checkout.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const y = document.getElementById("year");
            if (y) y.textContent = new Date().getFullYear();
        });
    </script>
</body>

</html>
