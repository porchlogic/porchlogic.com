<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Payment Successful</title>
	<link rel="stylesheet" href="../styles/base.css">
	<link rel="stylesheet" href="../styles/text.css">
</head>
<body onload="initPage();" class="bg-bg text-white flex flex-col items-center justify-center h-screen">

	<div id="header"></div>


	<h1 class="font-stealth text-4xl text-neonGreen">Thank You!</h1>
	<p class="text-lg mt-4">Your purchase was successful.</p>


	<p>Status: <span id="status"></span></p>
	<p>Email: <span id="email"></span></p>

	<div id="activation-section" style="display:none;">
	<h3>Your Activation Code:</h3>
	<pre id="activation-code" class="copy-code" style="font-size:1.5em; background:#eee; color:black; padding:10px; cursor:pointer;"></pre>
	<p>Click the code to copy it. Then paste it into your device config page.</p>
	<p id="copy-msg" style="display:none; color:lime;">Copied!</p>
	</div>

	<script>
		const urlParams = new URLSearchParams(window.location.search);
		const sessionId = urlParams.get('session_id');

		if (!sessionId) {
			document.getElementById('status').textContent = 'No session ID found.';
		} else {
			fetch(`https://api.porchlogic.com/session-status?session_id=${sessionId}`)
				.then(r => {
					if (!r.ok) throw new Error(`HTTP error! Status: ${r.status}`);
					return r.json();
				})
				.then(data => {
					document.getElementById('status').textContent = data.status;
					document.getElementById('email').textContent = data.customer_email;

					if (data.activation_codes && data.activation_codes.length > 0) {
						const activationSection = document.getElementById('activation-section');
						activationSection.innerHTML = '<h3>Your Activation Codes:</h3>';

						data.activation_codes.forEach(code => {
							const pre = document.createElement('pre');
							pre.className = 'copy-code';
							pre.style = 'font-size:1.5em; background:#eee; color:black; padding:10px; cursor:pointer; margin-bottom: 10px;';
							pre.textContent = code;

							pre.addEventListener('click', function() {
								navigator.clipboard.writeText(code)
									.then(() => {
										alert('Copied: ' + code);
									})
									.catch(err => {
										console.error('Failed to copy:', err);
									});
							});

							activationSection.appendChild(pre);
						});

						activationSection.style.display = 'block';
					}
				})
				.catch(err => {
					console.error('Error fetching session status:', err);
					document.getElementById('status').textContent = 'Error fetching session status.';
				});
		}
	</script>






</body>
</html>
